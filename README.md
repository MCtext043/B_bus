# Система продажи билетов Удмуртии

Веб-приложение для продажи билетов на автобусные рейсы по Удмуртской Республике.

## Дизайн
- **Белый фон** для максимальной читаемости
- **Черный текст** для основного контента
- **Красный акцент** для важных элементов
- **Минималистичный интерфейс** без лишних эффектов

## Функционал

### Для пассажиров (без регистрации):
- Просмотр рейсов на сегодня/завтра
- Выбор даты для просмотра рейсов
- Покупка билетов с указанием ФИО, телефона, места посадки
- Согласие с обработкой персональных данных (обязательно)
- Оплата через СБП или банковскую карту
- Поиск билетов по номеру телефона
- Архив билетов (автоматический перенос по дате)
- Статусы билетов: ожидание подтверждения → подтверждено → выполнено

### Для диспетчеров:
- Вход по логину/паролю
- Контроль рейсов на сегодня/завтра
- Управление пассажирами (подтверждение/отмена билетов)
- Создание новых рейсов
- Статусы билетов с причинами

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Заполнение базы данных тестовыми данными
```bash
python fill_data.py
```

### 3. Запуск сервера
```bash
python main.py
```

Сервер запустится на http://localhost:8001

## Вход в систему / роли

1. Откройте `http://localhost:8001/` — будет выбор роли:
   - **Пассажир** → `/user` (просмотр рейсов, покупка билетов без регистрации)
   - **Диспетчер** → вход/регистрация

### Диспетчеры
- Вход: `http://localhost:8001/dispatcher/login`
- Регистрация: `http://localhost:8001/dispatcher/register`
- Главный диспетчер (уже одобрен, имеет права super):
  - Логин: `dispatcher`
  - Пароль: `dispatcher123`
- Новый диспетчер после регистрации ждёт одобрения главного на `/dispatcher/dashboard`

### Тестовые данные:
- **Рейсы**: Ижевск-Балезино, Ижевск-Глазов, Балезино-Ижевск, Ижевск-Сарапул, Глазов-Ижевск
- **Билеты**: +7 (912) 345-67-89, +7 (922) 123-45-67 (для поиска)

## Структура проекта

```
udmurt_bus_system/
├── main.py              # Основной файл приложения FastAPI
├── models.py            # Модели базы данных (Trip, Ticket, Dispatcher)
├── database.py          # Настройка подключения к БД
├── auth.py              # Аутентификация диспетчеров
├── fill_data.py         # Заполнение тестовыми данными
├── requirements.txt     # Зависимости Python
├── README.md           # Документация
├── templates/          # HTML шаблоны
│   ├── base_udmurt.html
│   ├── user_home.html
│   ├── user_trip_details.html
│   ├── user_payment.html
│   ├── user_success.html
│   ├── user_tickets.html
│   ├── user_ticket_details.html
│   ├── dispatcher_login.html
│   ├── dispatcher_dashboard.html
│   ├── dispatcher_trips.html
│   ├── dispatcher_trip_details.html
│   ├── dispatcher_create_trip.html
│   └── error.html
└── static/             # Статические файлы
    └── css/
        └── udmurt-style.css
```

## API роуты

### Пользователи:
- `GET /` - Выбор роли
- `GET /user` - Главная (расписание)
- `GET /trip/{id}` - Детали рейса
- `POST /trip/{id}/book` - Покупка билета
- `POST /ticket/{id}/pay` - Оплата билета
- `GET /tickets` - Поиск билетов
- `POST /tickets/search` - Поиск по телефону
- `GET /ticket/{id}` - Детали билета

### Диспетчеры:
- `GET /dispatcher/login` - Вход
- `POST /dispatcher/login` - Аутентификация
- `GET /dispatcher/register` - Заявка на регистрацию
- `POST /dispatcher/register` - Отправка заявки
- `GET /dispatcher/dashboard` - Панель управления
- `POST /dispatcher/approve/{id}` - Одобрить диспетчера (только super)
- `POST /dispatcher/reject/{id}` - Отклонить диспетчера (только super)
- `GET /dispatcher/trips` - Список рейсов
- `GET /dispatcher/trip/{id}` - Детали рейса с пассажирами
- `GET /dispatcher/trip/{id}/edit` - Редактирование рейса
- `POST /dispatcher/trip/{id}/delete` - Удаление рейса
- `POST /dispatcher/ticket/{id}/status` - Изменение статуса билета
- `GET /dispatcher/create-trip` - Создание рейса
- `POST /dispatcher/create-trip` - Сохранение рейса

## Особенности реализации

- **Генерация номеров билетов**: 001-999 с автосбросом
- **Система статусов билетов**: Pending → Confirmed → Completed/Cancelled
- **Архив билетов**: Автоматический перенос по дате отправления
- **Удмуртский дизайн**: Фирменные цвета республики
- **Мобильная адаптация**: Bottom navigation для мобильных
- **Безопасность**: JWT токены, хеширование паролей

## Технологии

- **Backend**: FastAPI
- **Frontend**: Bootstrap 5, Jinja2 Templates
- **База данных**: SQLite
- **Стили**: Удмуртская цветовая гамма (черный, белый, красный)